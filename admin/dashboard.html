<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindspanAI Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f7fafc;
            min-height: 100vh;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            font-size: 28px;
        }

        .header h1 {
            font-size: 20px;
            color: #1a202c;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
        }

        .user-name {
            color: #4a5568;
            font-size: 14px;
            font-weight: 500;
        }

        .logout-btn {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            color: #4a5568;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #edf2f7;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #718096;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: -2px;
        }

        .tab:hover {
            color: #4a5568;
            background: #f7fafc;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
        }

        .card h2 {
            font-size: 18px;
            color: #1a202c;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f7fafc;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-warning {
            background: #feebc8;
            color: #744210;
        }

        .scrape-info {
            background: #f7fafc;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .scrape-info p {
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 8px;
        }

        .scrape-info p strong {
            color: #1a202c;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .alert-info {
            background: #bee3f8;
            color: #2c5282;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <div class="logo">‚öôÔ∏è</div>
            <h1>MindspanAI Admin</h1>
        </div>
        <div class="user-info">
            <img id="userAvatar" class="user-avatar" src="" alt="">
            <span id="userName" class="user-name"></span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('webscraper')">Website Scraper</button>
            <button class="tab" onclick="switchTab('knowledge')">Knowledge Base</button>
            <button class="tab" onclick="switchTab('ai')">AI Settings</button>
            <button class="tab" onclick="switchTab('config')">Site Config</button>
        </div>

        <!-- Website Scraper Tab -->
        <div id="tab-webscraper" class="tab-content active">
            <div class="card">
                <h2>Automatic Website Scraping</h2>
                <div class="alert alert-info">
                    <strong>Single Source of Truth:</strong> MindspanAI automatically scrapes www.mindspan.com.au daily at 2:00 AM to stay updated with the latest information.
                </div>

                <div class="scrape-info">
                    <p><strong>Last Scrape:</strong> <span id="lastScrape">Never</span></p>
                    <p><strong>Pages Monitored:</strong> 6 (Homepage, About, Services, Fees, FAQ, Contact)</p>
                    <p><strong>Status:</strong> <span id="scrapeStatus" class="status-badge status-success">Active</span></p>
                    <p><strong>Next Scheduled:</strong> <span id="nextScrape">Tomorrow at 2:00 AM</span></p>
                </div>

                <button class="btn" onclick="runScrapeNow()">üîÑ Run Scrape Now</button>
                <button class="btn btn-secondary" onclick="viewScrapedData()">üëÅÔ∏è View Scraped Data</button>
            </div>

            <div class="card">
                <h2>Change Detection</h2>
                <p style="color: #718096; font-size: 14px; margin-bottom: 16px;">
                    You'll receive email notifications when changes are detected on the website.
                </p>
                <div class="form-group">
                    <label>Notification Email</label>
                    <input type="email" id="notificationEmail" value="info@mindspan.com.au" placeholder="admin@mindspan.com.au">
                </div>
                <button class="btn">Save Email Settings</button>
            </div>
        </div>

        <!-- Knowledge Base Tab -->
        <div id="tab-knowledge" class="tab-content">
            <div class="card">
                <h2>Edit Knowledge Base</h2>
                <div class="alert alert-info">
                    The AI uses this information to answer questions. Website scraping automatically updates most of this, but you can manually override specific details here.
                </div>

                <div class="form-group">
                    <label>Services Offered</label>
                    <textarea id="services">1. Psychological Therapy & Assessment - anxiety, depression, trauma, PTSD, ADHD, relationships, couples
2. Executive Coaching & Consultancy - $250/session or $2,500/5-session package
3. Medico-Legal Services - TAC, NDIS, WorkCover, VOCAT, DVA</textarea>
                </div>

                <div class="form-group">
                    <label>Standard Session Fee</label>
                    <input type="text" id="sessionFee" value="$198.45">
                </div>

                <div class="form-group">
                    <label>Medicare Rebate</label>
                    <input type="text" id="medicareRebate" value="~$141.85">
                </div>

                <div class="form-group">
                    <label>Opening Hours</label>
                    <textarea id="hours">Wed & Thu: 9:30 AM - 5:00 PM
Sat: 9:00 AM - 4:00 PM
Telehealth available Australia-wide</textarea>
                </div>

                <button class="btn">üíæ Save Changes</button>
            </div>
        </div>

        <!-- AI Settings Tab -->
        <div id="tab-ai" class="tab-content">
            <div class="card">
                <h2>AI Model Configuration</h2>

                <div class="form-group">
                    <label>AI Model</label>
                    <select id="aiModel">
                        <option value="openai/gpt-3.5-turbo" selected>GPT-3.5 Turbo (Current - $0.50-2/month)</option>
                        <option value="openai/gpt-4">GPT-4 ($15-30/month - Higher quality)</option>
                        <option value="anthropic/claude-3-haiku">Claude 3 Haiku ($5-10/month - Fast)</option>
                        <option value="anthropic/claude-3-sonnet">Claude 3 Sonnet ($20-40/month - Best quality)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Temperature (Creativity)</label>
                    <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7">
                    <span id="tempValue">0.7</span>
                </div>

                <div class="form-group">
                    <label>Max Response Tokens</label>
                    <input type="number" id="maxTokens" value="300" min="100" max="1000" step="50">
                </div>

                <button class="btn">üíæ Save AI Settings</button>
            </div>

            <div class="card">
                <h2>AI Personality</h2>
                <div class="form-group">
                    <label>Current Personality: <span class="status-badge status-success">Warm & Friendly</span></label>
                    <p style="color: #718096; font-size: 14px; margin-top: 8px;">
                        The AI is configured to be conversational, empathetic, and helpful - like a friendly receptionist.
                    </p>
                </div>
            </div>
        </div>

        <!-- Site Config Tab -->
        <div id="tab-config" class="tab-content">
            <div class="card">
                <h2>Contact Information</h2>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="contactEmail" value="info@mindspan.com.au">
                </div>

                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="contactPhone" value="0451 614 155">
                </div>

                <div class="form-group">
                    <label>Booking URL</label>
                    <input type="url" id="bookingUrl" value="https://www.halaxy.com/book/appointment/ilker-abak/psychologist/359455/1336245">
                </div>

                <button class="btn">üíæ Save Contact Info</button>
            </div>

            <div class="card">
                <h2>Emergency Resources</h2>
                <div class="form-group">
                    <label>Emergency Contacts (displayed when crisis keywords detected)</label>
                    <textarea id="emergencyContacts">000 (Emergency)
Lifeline: 13 11 14
Beyond Blue: 1300 22 4636
Suicide Call Back: 1300 659 467</textarea>
                </div>
                <button class="btn">üíæ Save Emergency Contacts</button>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        const token = localStorage.getItem('mindspanai_admin_token');
        const user = JSON.parse(localStorage.getItem('mindspanai_admin_user') || '{}');

        if (!token) {
            window.location.href = '/admin/login.html';
        }

        // Display user info
        if (user.name) {
            document.getElementById('userName').textContent = user.name;
        }
        if (user.picture) {
            document.getElementById('userAvatar').src = user.picture;
        }

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to selected tab
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        // Logout
        function logout() {
            localStorage.removeItem('mindspanai_admin_token');
            localStorage.removeItem('mindspanai_admin_user');
            window.location.href = '/admin/login.html';
        }

        // Run scrape now
        async function runScrapeNow() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'üîÑ Scraping...';

            try {
                const response = await fetch('/api/scrape-website', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    alert(`‚úÖ Scrape completed!\n\nPages scraped: ${data.scrapedPages}\nTimestamp: ${new Date(data.timestamp).toLocaleString()}`);
                    document.getElementById('lastScrape').textContent = new Date(data.timestamp).toLocaleString();
                } else {
                    alert('‚ùå Scrape failed: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                alert('‚ùå Error: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîÑ Run Scrape Now';
            }
        }

        // View scraped data
        function viewScrapedData() {
            alert('Scraped data viewer coming soon!\n\nThis will show you all the content extracted from www.mindspan.com.au');
        }

        // Temperature slider
        const tempSlider = document.getElementById('temperature');
        const tempValue = document.getElementById('tempValue');
        tempSlider.addEventListener('input', function() {
            tempValue.textContent = this.value;
        });
    </script>
</body>
</html>
